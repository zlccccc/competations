不考虑多组询问，把询问的链单独拿出来做，就变成了很简单的问题，

记F[i]为走到当前节点，游览的总美丽度$S \equiv i(mod  k) $的游览方案数。

所以可以先离线询问，然后分治，对于每个根$O(n*k)$求出他到达每个点每种美丽度的方案数

$O(k^2)$回答每组询问即可。